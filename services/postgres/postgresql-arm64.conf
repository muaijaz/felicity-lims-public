# PostgreSQL ARM64-Optimized Configuration for Apple Silicon
# M2/M3/M4 specific tuning for development environment

# Memory Configuration (optimized for Apple Silicon unified memory)
shared_buffers = 512MB              # 25% of container memory (2GB limit)
effective_cache_size = 1536MB       # 75% of container memory
work_mem = 32MB                     # Per-operation memory
maintenance_work_mem = 256MB        # Maintenance operations

# Connection Settings
max_connections = 100
superuser_reserved_connections = 3

# Write-Ahead Log (WAL) - optimized for Apple Silicon SSD
wal_buffers = 16MB
min_wal_size = 1GB
max_wal_size = 4GB
wal_compression = on                # Compress WAL (good for SSD)

# Checkpoints (tuned for Apple Silicon SSD performance)
checkpoint_timeout = 15min
checkpoint_completion_target = 0.9
checkpoint_warning = 30s

# Query Planner
random_page_cost = 1.1              # SSD-optimized (down from 4.0)
effective_io_concurrency = 200      # Apple Silicon has excellent I/O
default_statistics_target = 100

# Parallel Query (leverage M2/M3/M4 cores)
max_parallel_workers_per_gather = 2
max_parallel_maintenance_workers = 2
max_parallel_workers = 4
parallel_setup_cost = 100
parallel_tuple_cost = 0.01

# JIT Compilation (ARM64 native)
jit = on                            # Enable JIT for ARM64 performance
jit_above_cost = 100000
jit_inline_above_cost = 500000
jit_optimize_above_cost = 500000

# Logging (minimal for development)
log_destination = 'stderr'
logging_collector = off
log_line_prefix = '%m [%p] %q%u@%d '
log_timezone = 'UTC'

# Locale
datestyle = 'iso, mdy'
timezone = 'UTC'
lc_messages = 'en_US.UTF-8'
lc_monetary = 'en_US.UTF-8'
lc_numeric = 'en_US.UTF-8'
lc_time = 'en_US.UTF-8'

# Autovacuum (tuned for development workload)
autovacuum = on
autovacuum_naptime = 1min
autovacuum_vacuum_threshold = 50
autovacuum_analyze_threshold = 50
autovacuum_vacuum_scale_factor = 0.2
autovacuum_analyze_scale_factor = 0.1

# Client Connection Defaults
default_text_search_config = 'pg_catalog.english'
